---
- name: install postgress sql
  hosts: app
  become: yes
  
  tasks:
  - name: Install a modularity appstream with de
    ansible.builtin.dnf:
      name:
        - '@postgresql:{{ postgresql_vervion }}'
        - postgresql-contrib
      state: present

  - name: Check if PostgreSQL is initialized
    ansible.builtin.stat:
      path: "{{ postgresql_data_dir }}/pg_hba.conf"
    register: postgres_data

  - name: create data dir
    ansible.builtin.file:
      path: 
        - "{{ postgresql_data_dir }}"
      owner: postgres
      group: postgres
      state: directory

  - name: create data dir
    ansible.builtin.file:
      path: /etc/systemd/system/postgresql.service.d
      owner: postgres
      group: postgres
      state: directory

  - name: Template a file to /etc/file.conf
    ansible.builtin.template:
      src: ./override.j2
      dest: /etc/systemd/system/postgresql.service.d/override.conf
      owner: postgres
      group: postgres

  - name: Restart service cron on centos, in all cases, also issue daemon-reload to pick up config changes
    ansible.builtin.systemd:
      state: restarted
     
 daemon_reload: yes
  - name: Run comman
    ansible.builtin.shell:
     cmd: systemctl daemon-reload

  - name: Run comman
    ansible.builtin.command:
     cmd: postgresql-setup initdb
